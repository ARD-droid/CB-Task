CREATE DATABASE DOCTOR_PATIENT;
USE DOCTOR_PATIENT;

CREATE TABLE DOCTOR (
DOCTOR_ID INT PRIMARY KEY ,
FIRST_NAME VARCHAR(100),
LAST_NAME VARCHAR(100),
EMAIL VARCHAR(100),
PHONE VARCHAR(100),
DEPARTMENT_ID INT,
SPECIALITY_ID INT,
JOINING_DATE DATE,
FOREIGN KEY (DEPARTMENT_ID) REFERENCES DEPARTMENT(DEPARTMENT_ID),
FOREIGN KEY (SPECIALITY_ID) REFERENCES SPECIALITIES(SPECIALITIE_ID)
 );

 INSERT INTO DOCTOR (DOCTOR_ID,FIRST_NAME,LAST_NAME,EMAIL,PHONE,DEPARTMENT_ID ,SPECIALITY_ID,JOINING_DATE )
 VALUES
 (1, 'John', 'Smith', 'john.smith@hospital.com', '1234567890', 1, 1, '2020-01-10'),
(2, 'Alice', 'Brown', 'alice.brown@hospital.com', '2345678901', 2, 2, '2019-03-20'),
(3, 'Robert', 'Taylor', 'robert.taylor@hospital.com', '3456789012', 1, 3, '2021-07-15');
 
 SELECT * FROM DOCTOR;
 
 CREATE TABLE PATIENT ( 
 PATIENT_ID INT PRIMARY KEY,
 FIRST_NAME VARCHAR(100),
 LAST_NAME VARCHAR(100),
 EMAIL VARCHAR(100),
 PHONE varchar(20),
 DOB DATE,
 GENDER VARCHAR(100),
 ADDRESS TEXT 
 );
 INSERT INTO PATIENT VALUES
 (101, 'Emily', 'Davis', 'emily.davis@example.com', 9876543210, '1990-05-10', 'Female', '123 Main Street'),
(102, 'Daniel', 'Wilson', 'daniel.wilson@example.com', 8765432109, '1985-11-20', 'Male', '456 Oak Avenue'),
(103, 'Sophia', 'Johnson', 'sophia.johnson@example.com', 7654321098, '2000-02-15', 'Female', '789 Pine Road');


 
 CREATE TABLE DEPARTMENT(
 DEPARTMENT_ID INT PRIMARY KEY,
 DEPARTMENT_NAME VARCHAR(100)
 );
 
 INSERT INTO DEPARTMENT VALUES 
( 1, 'Cardiology'),
(2, 'Dermatology');

 CREATE TABLE SPECIALITIES(
 SPECIALITY_ID INT PRIMARY KEY,
 SPECIALITY_NAME VARCHAR(100)
 );
 
 INSERT INTO SPECIALITIES VALUES
 (1, 'Cardiology'),
 (2, 'Dermatology'),
 (3, 'Neurology');
 
 SELECT * FROM SPECIALITIES;
 
 CREATE TABLE APPOINTMENTS(
 APPOINTMENT_ID INT PRIMARY KEY,
 DOCTOR_ID INT ,
 PATIENT_ID INT ,
 APPOINTMENT_DATE DATETIME ,
 REASON TEXT ,
 STATUS VARCHAR(20),
 FOREIGN KEY (DOCTOR_ID ) REFERENCES DOCTOR (DOCTOR_ID),
 FOREIGN KEY ( PATIENT_ID) REFERENCES PATIENT( PATIENT_ID)
 );

 
INSERT INTO APPOINTMENTS VALUES 
(1001, 1, 101, '2024-07-01 10:00:00', 'Chest pain', 'Completed'),
(1002, 1, 102, '2024-07-05 14:30:00', 'Regular check-up', 'Cancelled'),
(1003, 2, 101, '2024-07-07 09:00:00', 'Skin rash', 'Scheduled'),
(1004, 3, 103, '2024-07-08 11:15:00', 'Headache', 'Completed'),
(1005, 1, 103, '2024-07-10 13:00:00', 'Heart check-up', 'Completed');


CREATE TABLE PAYMENT (
PAYMENT_ID INT PRIMARY KEY,
APPOINTMENT_ID INT,
PAYMENT_DATE DATE,
PAYMENT_AMOUNT DECIMAL(10,2),
PAYMENT_METHOD VARCHAR(20),
FOREIGN KEY (APPOINTMENT_ID) REFERENCES APPOINTMENTS (APPOINTMENT_ID)
 );

INSERT INTO PAYMENT VALUES 
(5001, 1001, '2024-07-01', 200.00, 'Cash'),
(5002, 1004, '2024-07-08', 150.00, 'Credit Card'),
(5003, 1005, '2024-07-10', 180.00, 'Insurance');

##----------------------------------------------------------------QUERIES-------------------------------------------


## QUERY-1 --> Find the Total Number of Appointments for Each Doctor

SELECT APPOINTMENTS.DOCTOR_ID ,DOCTOR.FIRST_NAME, COUNT(APPOINTMENTS.APPOINTMENT_ID)
FROM APPOINTMENTS
LEFT JOIN DOCTOR
ON DOCTOR.DOCTOR_ID=APPOINTMENTS.DOCTOR_ID
GROUP BY APPOINTMENTS.DOCTOR_ID,DOCTOR.DOCTOR_ID, DOCTOR.FIRST_NAME;

## QUERY-2 --> List All Patients Who Have an Appointment with a Specific Doctor (e.g., Dr. John Smith)

SELECT PATIENT.PATIENT_ID,PATIENT.FIRST_NAME,PATIENT.LAST_NAME FROM PATIENT
INNER JOIN APPOINTMENTS ON APPOINTMENTS.PATIENT_ID=PATIENT.PATIENT_ID
INNER JOIN DOCTOR ON DOCTOR.DOCTOR_ID =APPOINTMENTS.DOCTOR_ID
WHERE DOCTOR.FIRST_NAME ='John' AND DOCTOR.LAST_NAME='Smith'; 

## QUERY_3 --> Find the Number of Appointments Scheduled in a Specific Department

SELECT DEPARTMENT. DEPARTMENT_ID,DEPARTMENT.DEPARTMENT_NAME,COUNT(APPOINTMENTS.APPOINTMENT_ID)
FROM DEPARTMENT
LEFT JOIN DOCTOR ON DOCTOR.DEPARTMENT_ID=DEPARTMENT.DEPARTMENT_ID
LEFT JOIN  APPOINTMENTS ON APPOINTMENTS.DOCTOR_ID=DOCTOR.DOCTOR_ID
GROUP BY DEPARTMENT. DEPARTMENT_ID,DEPARTMENT.DEPARTMENT_NAME;

## QUERY-4 --> Find the Most Popular Specialty Based on Number of Appointments 

SELECT SPECIALITIES.SPECIALITY_ID,SPECIALITIES. SPECIALITY_NAME AS MOST_POPULAR,COUNT(APPOINTMENTS.APPOINTMENT_ID) AS TOTAL_APPOINTMENTS
FROM SPECIALITIES
INNER JOIN DOCTOR ON DOCTOR.SPECIALITY_ID=SPECIALITIES.SPECIALITY_ID
INNER JOIN APPOINTMENTS ON APPOINTMENTS.DOCTOR_ID=DOCTOR.DOCTOR_ID
GROUP BY SPECIALITIES.SPECIALITY_ID,SPECIALITIES. SPECIALITY_NAME
ORDER BY TOTAL_APPOINTMENTS DESC LIMIT 1 ;

## QUERY-5 --> Get the Total Payment Amount for All Completed Appointments

SELECT SUM(PAYMENT.PAYMENT_AMOUNT) FROM PAYMENT
LEFT JOIN APPOINTMENTS ON PAYMENT.APPOINTMENT_ID=APPOINTMENTS.APPOINTMENT_ID
WHERE  APPOINTMENTS.STATUS='Completed';

## QUERY-6 --> Find the Number of Patients Seen by Each Doctor

SELECT DOCTOR.DOCTOR_ID,DOCTOR.FIRST_NAME ,COUNT(PATIENT.PATIENT_ID)
FROM DOCTOR 
LEFT JOIN APPOINTMENTS ON APPOINTMENTS.DOCTOR_ID=DOCTOR.DOCTOR_ID
LEFT JOIN PATIENT ON PATIENT.PATIENT_ID=APPOINTMENTS.PATIENT_ID
GROUP BY DOCTOR.DOCTOR_ID,DOCTOR.FIRST_NAME;

## QUERY-7 --> List All Patients Who Have Missed Their Appointments (Status 'Cancelled')

SELECT APPOINTMENTS.PATIENT_ID,PATIENT.FIRST_NAME 
FROM PATIENT
INNER JOIN  APPOINTMENTS ON APPOINTMENTS.PATIENT_ID =PATIENT.PATIENT_ID
WHERE  APPOINTMENTS.STATUS='Cancelled';

## QUERY-8 --> Find the Total Number of Appointments for Each Status (Scheduled, Completed, Cancelled)

SELECT COUNT(APPOINTMENT_ID), STATUS FROM APPOINTMENTS
GROUP BY STATUS ;

## QUERY-9 --> Get the Average Payment Amount for Completed Appointments

SELECT AVG(PAYMENT.PAYMENT_AMOUNT) FROM PAYMENT
INNER JOIN APPOINTMENTS ON APPOINTMENTS.APPOINTMENT_ID=PAYMENT.APPOINTMENT_ID
WHERE APPOINTMENTS.STATUS='Completed';

## QUERY-10 --> Find the Doctor with the Highest Number of Appointments

SELECT APPOINTMENTS.DOCTOR_ID,DOCTOR.FIRST_NAME ,COUNT(APPOINTMENTS.APPOINTMENT_ID) AS MAX_APPOINTMENTS
FROM DOCTOR
INNER JOIN APPOINTMENTS ON APPOINTMENTS.DOCTOR_ID=DOCTOR.DOCTOR_ID
GROUP BY DOCTOR.DOCTOR_ID,DOCTOR.FIRST_NAME
ORDER BY MAX_APPOINTMENTS DESC LIMIT 1;



